<div class="app-wrapper">

  <!-- ROLE SELECTION OVERLAY (NEW) -->
  <div class="role-overlay" *ngIf="!role" style="position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.45);">
    <div style="background:#fff;padding:22px;border-radius:12px;max-width:420px;width:92%;text-align:center;">
      <h3 style="margin:0 0 8px 0;color:#e31837;">Choose your role</h3>
      <p style="color:#555;margin-bottom:16px;">Select whether you are an <strong>Agent</strong> (receive calls) or a <strong>Supplier</strong> (make calls).</p>
      <div style="display:flex;gap:12px;justify-content:center;">
        <button (click)="setRole('agent')" style="padding:10px 18px;border-radius:8px;border:none;background:#e31837;color:#fff;cursor:pointer;">Agent (receive)</button>
        <button (click)="setRole('supplier')" style="padding:10px 18px;border-radius:8px;border:1px solid #ddd;background:#fff;color:#333;cursor:pointer;">Supplier (call)</button>
      </div>
      <p style="font-size:12px;color:#777;margin-top:12px;">You can change this later by refreshing the page.</p>
    </div>
  </div>
  <!-- END ROLE SELECTION OVERLAY -->

  <!-- Minimized Chatbot View -->
  <div class="minimized-chatbot" *ngIf="isMinimized" (click)="toggleChatbot()">
    <div class="floating-robot">
      <div class="robot-bubble">
        <div class="bubble-text">Having trouble? I'm Here To Help</div>
        <div class="bubble-tail"></div>
      </div>
      <div class="robot-icon">
        <div class="robot-head">
          <div class="robot-face">
            <div class="robot-eye left-eye"></div>
            <div class="robot-eye right-eye"></div>
            <div class="robot-mouth"></div>
          </div>
          <div class="robot-antenna"></div>
        </div>
        <div class="robot-body">
          <div class="robot-detail"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Expanded Chatbot View -->
  <div class="expanded-chatbot" *ngIf="!isMinimized">
    <div class="modern-header">
      <div class="header-left">
        <div class="logo">
          <i class="material-icons">android</i>
          <span>CARA 2.0</span>
        </div>
      </div>

      <div class="header-center">
        <!-- <h2>Chat Assistant</h2> -->
        <div class="status">
          <span class="status-dot"></span>
          <span>Online</span>
        </div>
      </div>

      <div class="header-right">
        <button class="header-btn close-btn" (click)="toggleChatbot()">
          <i class="material-icons">close</i>
        </button>
      </div>
    </div>

    <div class="app-container">
      <app-sidebar-component
        [collapsed]="isSidebarCollapsed"
        [currentView]="currentView"
        (toggleSidebar)="toggleSidebar()"
        (changeView)="changeView($event)">
      </app-sidebar-component>

      <div class="main-content" [class.sidebar-collapsed]="isSidebarCollapsed" [class.sidebar-expanded]="!isSidebarCollapsed">
        <div *ngIf="currentView === 'chat'" class="h-100">
          <app-chat-area-component
            [isListening]="isListening"
            [session]="currentSession"
            (startListening)="onStartListening()"
            (stopListening)="onStopListening()"
            (sessionUpdated)="onSessionUpdated($event)"
            (startCall)="handleStartCall()">
          </app-chat-area-component>
        </div>

        <div *ngIf="currentView === 'history'" class="h-100">
          <app-chat-history-component (sessionSelected)="onSessionSelected($event)">
          </app-chat-history-component>
        </div>

        <div *ngIf="currentView === 'callAssistant'" class="h-100">
          <app-call-assistant [role]="role"></app-call-assistant>
        </div>

        <div *ngIf="currentView === 'faqs'" class="h-100">
          <app-faqs ></app-faqs>
        </div>


      </div>
      <!-- validator view removed -->
    </div>


  </div>
</div>
