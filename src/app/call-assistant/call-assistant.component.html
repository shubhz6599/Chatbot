<div class="assistant-container">

  <!-- Header -->
  <div class="assistant-header" *ngIf="!callSubmitted && !inQueue">
    <h2>Call Assistant</h2>
    <p class="assistant-subtitle" *ngIf="role !== 'agent'">Call us directly from your browser</p>
  </div>

  <div class="assistant-body">
    <!-- Before Call -->
    <!-- Supplier UI (make call) -->
    <div *ngIf="role === 'supplier' && !callSubmitted && !inQueue && !showIncomingPanel" class="call-form">
      <button class="btn-call" (click)="startBrowserCall()" [disabled]="isInitializing">
        <i class="material-icons">call</i>
      </button>
      <p *ngIf="errorMessage" class="error-text">{{ errorMessage }}</p>
      <p *ngIf="!errorMessage && !isInitializing" class="hint">
        Press the green call button to speak with a live agent. —please enable microphone access when prompted.
      </p>
      <p *ngIf="isInitializing" class="hint">
        Initializing… please allow microphone access when prompted.
      </p>
    </div>

    <!-- Agent UI (wait for calls) -->
    <div *ngIf="role === 'agent' && !callSubmitted && !showIncomingPanel && !inQueue" class="agent-wait">
      <p class="status-text" >{{ callStatus }}</p>
      <p *ngIf="!errorMessage" class="hint">Waiting for incoming calls… keep this page open.</p>
      <p *ngIf="errorMessage" class="error-text">{{ errorMessage }}</p>
    </div>


    <!-- INCOMING CALL PANEL (AGENT) -->
    <div *ngIf="showIncomingPanel && incomingCall" class="incoming-panel">
      <div class="incoming-card">
        <h3>Incoming call</h3>
        <p class="incoming-from">From: {{ incomingCaller || 'Unknown' }}</p>
        <div class="incoming-actions">
          <button class="action-accept" (click)="acceptIncoming()"><i class="material-icons">call</i> Accept</button>
          <button class="action-reject" (click)="rejectIncoming()"><i class="material-icons">call_end</i>
            Reject</button>
        </div>
      </div>
    </div>

    <!-- Queue Screen -->
    <div *ngIf="inQueue && !callSubmitted && !showIncomingPanel" class="queue-screen">
      <div class="queue-card">
        <div class="queue-loader"></div>
        <h3>You are in queue: <span class="queue-number">{{ queueNumber }}</span></h3>
        <p class="queue-message">“{{ currentMessage }}”</p>
        <p class="waiting-text">Please stay with us… connecting shortly</p>
      </div>
    </div>

    <!-- During Call -->
    <div *ngIf="callSubmitted" class="call-screen fade-in">
      <div class="avatar-container">
        <div class="pulse-ring"></div>
        <div class="avatar">
          <i class="material-icons">account_circle</i>
        </div>
      </div>

      <p class="twilio-number">1800 209 4455</p>
      <!-- Uncomment below Line if want To show dynamic number nodejs TARGET_NUMBER inside .env file -->
      <!-- <p class="twilio-number">{{ displayNumber }}</p> -->
      <p class="status-text">{{ callStatus }}</p>
      <p class="call-duration" *ngIf="callStatus === 'In Call'">{{ callDuration }}</p>

      <div class="call-actions">
        <button class="action-btn" (click)="toggleMute()">
          <i class="material-icons">{{ isMuted ? 'mic_off' : 'mic' }}</i>
          <span>Mute</span>
        </button>

        <button class="end-btn" (click)="endCall()">
          <i class="material-icons">call_end</i>
        </button>
      </div>
    </div>
  </div>
</div>
